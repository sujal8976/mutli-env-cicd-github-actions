<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Manager - Home</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif;
        background: #f5f5f5;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        margin-bottom: 10px;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }
      .env-badge {
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        margin-left: 10px;
      }
      .env-production {
        background: #dc3545;
        color: white;
      }
      .env-development {
        background: #28a745;
        color: white;
      }
      .env-testing {
        background: #ffc107;
        color: #000;
      }
      .btn {
        padding: 10px 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
      }
      .btn:hover {
        background: #0056b3;
      }
      .filters {
        margin-bottom: 20px;
        display: flex;
        gap: 10px;
      }
      select {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .task-list {
        display: grid;
        gap: 15px;
      }
      .task-card {
        border: 1px solid #ddd;
        padding: 20px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .task-card:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
      }
      .task-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 8px;
      }
      .task-meta {
        display: flex;
        gap: 15px;
        font-size: 14px;
        color: #666;
        margin-bottom: 10px;
      }
      .badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
      }
      .status-pending {
        background: #ffc107;
        color: #000;
      }
      .status-in-progress {
        background: #17a2b8;
        color: white;
      }
      .status-completed {
        background: #28a745;
        color: white;
      }
      .priority-low {
        background: #6c757d;
        color: white;
      }
      .priority-medium {
        background: #fd7e14;
        color: white;
      }
      .priority-high {
        background: #dc3545;
        color: white;
      }
      .task-actions {
        margin-top: 10px;
        display: flex;
        gap: 10px;
      }
      .btn-sm {
        padding: 6px 12px;
        font-size: 14px;
      }
      .btn-danger {
        background: #dc3545;
      }
      .btn-danger:hover {
        background: #c82333;
      }
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div>
          <h1>
            Task Manager
            <span id="envBadge" class="env-badge"></span>
          </h1>
          <p>Manage your tasks efficiently</p>
          <h3>Manage task easily.</h3>
        </div>
        <a href="/create" class="btn">+ New Task</a>
      </div>

      <div class="filters">
        <select id="statusFilter">
          <option value="">All Status</option>
          <option value="pending">Pending</option>
          <option value="in-progress">In Progress</option>
          <option value="completed">Completed</option>
        </select>
        <select id="priorityFilter">
          <option value="">All Priority</option>
          <option value="low">Low</option>
          <option value="medium">Medium</option>
          <option value="high">High</option>
        </select>
      </div>

      <div id="taskList" class="task-list"></div>
    </div>

    <script>
      let tasks = [];

      async function loadEnvironment() {
        try {
          const response = await fetch("/api/env");
          const data = await response.json();
          const env = data.environment;
          const badge = document.getElementById("envBadge");

          if (env === "production") {
            badge.textContent = "PROD";
            badge.className = "env-badge env-production";
          } else if (env === "testing" || env === "test") {
            badge.textContent = "TEST";
            badge.className = "env-badge env-testing";
          } else {
            badge.textContent = "DEV";
            badge.className = "env-badge env-development";
          }
        } catch (error) {
          console.error("Failed to load environment:", error);
        }
      }

      async function loadTasks() {
        try {
          const response = await fetch("/api/tasks");
          tasks = await response.json();
          renderTasks();
        } catch (error) {
          console.error("Failed to load tasks:", error);
        }
      }

      function filterTasks() {
        const status = document.getElementById("statusFilter").value;
        const priority = document.getElementById("priorityFilter").value;
        return tasks.filter((task) => {
          return (
            (!status || task.status === status) &&
            (!priority || task.priority === priority)
          );
        });
      }

      function renderTasks() {
        const filtered = filterTasks();
        const container = document.getElementById("taskList");

        if (filtered.length === 0) {
          container.innerHTML =
            '<div class="empty-state"><h3>No tasks found</h3><p>Create your first task to get started</p></div>';
          return;
        }

        container.innerHTML = filtered
          .map(
            (task) => `
        <div class="task-card" onclick="viewTask('${task._id}')">
          <div class="task-title">${task.title}</div>
          <div class="task-meta">
            <span class="badge status-${task.status}">${task.status.replace(
              "-",
              " "
            )}</span>
            <span class="badge priority-${task.priority}">${
              task.priority
            }</span>
          </div>
          <div>${task.description || "No description"}</div>
          <div class="task-actions">
            <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteTask('${
              task._id
            }')">Delete</button>
          </div>
        </div>
      `
          )
          .join("");
      }

      function viewTask(id) {
        window.location.href = `/task/${id}`;
      }

      async function deleteTask(id) {
        if (!confirm("Are you sure you want to delete this task?")) return;
        try {
          await fetch(`/api/tasks/${id}`, { method: "DELETE" });
          await loadTasks();
        } catch (error) {
          console.error("Failed to delete task:", error);
        }
      }

      document
        .getElementById("statusFilter")
        .addEventListener("change", renderTasks);
      document
        .getElementById("priorityFilter")
        .addEventListener("change", renderTasks);

      // Load environment and tasks on page load
      loadEnvironment();
      loadTasks();
    </script>
  </body>
</html>
